# Homecoming App - Version 0.6.0 Release Notes

**Release Date:** October 17, 2025  
**Version:** 0.6.0+6  
**Build Type:** Release

## ğŸ‰ Major Feature: Native Voice Input with WhisperAI

### âœ… What's New

#### 1. **Voice Recording Functionality**
- âœ… **Native Android MediaRecorder** - Works perfectly in overlay isolate
- âœ… **Tap and hold microphone** button to record voice
- âœ… **Automatic transcription** via OpenAI Whisper API
- âœ… **AAC audio format** (44.1kHz, 128kbps) optimized for speech recognition

#### 2. **Secure API Key Management**
- âœ… **Flutter Secure Storage** with Android Keystore encryption
- âœ… **Hardware-backed security** for API keys
- âœ… **First-time setup screen** for easy configuration
- âœ… **In-memory caching** for performance

#### 3. **Developer Convenience**
- âœ… **Dev mode toggle** (`USE_DEV_MODE` flag)
- âœ… **Auto-populate API keys** during development
- âœ… **Skip setup screen** when testing

### ğŸ”§ Technical Implementation

**Native Voice Recording:**
- Custom `AudioRecorderPlugin.java` using Android MediaRecorder API
- MethodChannel bridge between Dart and native Android
- Registered in both MainActivity AND OverlayService for full compatibility
- Works in overlay isolates (solved MissingPluginException issue)

**Architecture:**
```
User taps mic â†’ VoiceService â†’ NativeAudioRecorder 
  â†’ MethodChannel â†’ AudioRecorderPlugin.java 
  â†’ MediaRecorder â†’ AAC file â†’ Whisper API â†’ Transcription
```

### ğŸ“ Files Modified/Created

**New Files:**
- `lib/services/native_audio_recorder.dart` - Dart wrapper for native recorder
- `lib/services/secure_storage_service.dart` - Encrypted API key storage
- `lib/api_key_setup_screen.dart` - First-time setup UI
- `lib/dev_config.dart` - Development mode configuration
- `packages/flutter_overlay_window/.../AudioRecorderPlugin.java` - Native recorder
- `NATIVE_AUDIO_RECORDER.md` - Implementation documentation

**Modified Files:**
- `lib/services/voice_service.dart` - Removed flutter_sound, use native recorder
- `lib/main_overlay.dart` - Integrated dev mode and API key setup
- `packages/flutter_overlay_window/.../OverlayService.java` - Registered audio plugin
- `android/app/.../MainActivity.kt` - Registered audio plugin
- `pubspec.yaml` - Removed flutter_sound dependency

### ğŸ§ª Testing Status

**âœ… Confirmed Working on Emulator:**
- Voice recording starts successfully
- Audio file saved (41,962 bytes for ~3 seconds)
- MediaRecorder functioning correctly
- Overlay isolate communication working
- Permission handling correct

**â³ Pending Real Device Test:**
- Whisper API transcription (requires internet - emulator DNS failed)
- End-to-end voice â†’ text â†’ AI response flow
- Real microphone audio quality

### ğŸ“± Installation & Setup

**First Launch:**
1. App will request microphone permission
2. Setup screen appears for API key configuration
3. Enter your OpenAI API key
4. Enter your ElevenLabs API key (optional)
5. Keys are encrypted and stored securely

**Voice Input Usage:**
1. Tap chat bubble to open chat interface
2. Tap and hold the microphone button ğŸ¤
3. Speak your message
4. Release the button
5. Audio is transcribed via Whisper AI
6. Text appears in chat and sends to Kai

### ğŸ” Security Features

- **Android Keystore** encryption for API keys
- **Hardware-backed** security (if device supports it)
- **No plaintext storage** of sensitive data
- **In-memory caching** to minimize decryption overhead

### ğŸ› Known Issues

- **Emulator DNS issue**: Whisper API fails on emulator due to network connectivity
  - **Solution**: Test on real device with WiFi/mobile data
- **SDK 36 warnings**: Non-blocking warnings about newer SDK requirements

### ğŸ“Š Performance

- **APK Size**: 47.6 MB (release build)
- **Recording latency**: ~260ms to start recording
- **File size**: ~12 KB per second of audio (AAC compression)

### ğŸ¯ Next Steps

1. **Test on real device** to verify Whisper API transcription
2. **Add visual feedback** during recording (waveform animation)
3. **Implement retry logic** for failed transcriptions
4. **Add offline mode** for when API is unreachable
5. **Optimize audio quality** based on real device testing

### ğŸ“ Changelog

**v0.6.0 (October 17, 2025)**
- âœ¨ NEW: Native voice recording with Android MediaRecorder
- âœ¨ NEW: WhisperAI transcription integration
- âœ¨ NEW: Secure API key storage with Android Keystore
- âœ¨ NEW: First-time setup screen for API keys
- âœ¨ NEW: Developer mode for convenient testing
- ğŸ”§ CHANGED: Removed flutter_sound dependency
- ğŸ”§ CHANGED: Updated to native MethodChannel approach
- ğŸ› FIXED: Voice recording now works in overlay isolate
- ğŸ“š DOCS: Added NATIVE_AUDIO_RECORDER.md documentation

**Previous Versions:**
- v0.5.0 - Voice input attempt (flutter_sound - failed in overlay)
- v0.4.0 - Security system implementation
- v0.3.0 - Responsive drag improvements
- v0.2.0 - Initial overlay implementation
- v0.1.0 - Basic chat functionality

### ğŸ™ Credits

Built with:
- Flutter & Dart
- Android Native (Kotlin/Java)
- OpenAI Whisper API
- ElevenLabs TTS API
- Flutter Overlay Window (custom fork)

---

**Ready for real device testing! ğŸš€**

For issues or questions, contact the development team.
